---
authors: []
title: Untitled
---

# HTML codec

The `html` codec is for decoding from, and encoding to, HyperText Markup Lanuguage (HTML), the format widely used for viewing content in web browsers.

## Philosophy

Generation of semantically correct and accessible HTML is the guiding principle behind the design of this codec.

To this end the codec strives to, where possible, generate semantically correct HTML from the [Stencila Schema](https://github.com/stencila/schema) objects, and augmenting the HTML with supplementary standards such as [MircoData](https://www.w3.org/TR/microdata/) as needed.

### Lossless encoding to HTML

The aim of this codec is to be able to publish Stencila documents as completely as possible. We use several methods for this, including storing non-rendered metadata as JSON-LD in document `<head>` tag, and enriching native HTML5 tags with [MircoData](https://www.w3.org/TR/microdata/) attributes like `itemtype` and `item prop`.

### Lossy decoding from HTML

Due to the extremely flexible nature of HTML markup, and the innumerable possibilities of examples, this codec does not provide guarantees about lossless decoding from all possible HTML documents.

However we do aim to be isomorphic when working with HTML documents generated by Encoda. That is, the decoding of an HTML document generated by Encoda, should produce a Stencila Document Tree identical to the one that generated it.

### Maximize machine-readability of HTML

Use semantic tags whenever possible, and microdata `itemtype` and `itemprop` attributes to allow for semantic search, and hydration of web components from HTML.

## Encoding

### Metadata

As previously mentioned, valid JSON-LD data may be stored in the `<head>` of a document

### Example

```json
{
  "type": "Article",
  "title": "An example of encoding an article",
  "authors": [
    {
      "type": "Person",
      "givenNames": ["Janet"],
      "familyNames": ["Carberry"],
      "affiliations": {
        "type": "Organization",
        "name": "Brown University"
      },
      "favoriteColour": "red"
    }
  ],
  "content": [
    { "type": "Heading", "depth": 2, "content": ["My Article title"] },
    {
      "type": "Paragraph",
      "content": [
        "Citing an article,",

        { "type": "Cite", "target": "some-one-else-1991" },
        "inside this article."
      ]
    }
  ],
  "references": [
    {
      "type": "Article",
      "id": "some-one-else-1991",
      "title": "Another article",
      "authors": [
        {
          "type": "Person",
          "givenNames": ["Some", "One"],
          "familyNames": ["Else"]
        }
      ],
      "datePublished": "1991-01-01"
    }
  ]
}
```

Running the above file through Encoda's `convert --to html` function, returns the HTML below. It has been annotated with comments, highlighting how the different various elements of the Stencila Document Tree get encoded to HTML.

* * *

## Microdata and semantic tag usage (WIP)

### Schema nodes to add microdata to

-   Article

    -   `article` `itemtype='schema:Article'`
    -   itemprops:

        -   authors\* (author?): `ol`
        -   title\*: `h1`? (+ `title`)
        -   environment: `data`?
-   Brand

    -   `picture`/`img` `itemtype='schema:Brand'`
    -   itemprops:

        -   name: maybe unnecessary, just use in alt tag?
        -   logo\*: `source`/`image`
        -   reviews
-   Cite

    -   `ul` `itemtype='stencila:Cite'`
    -   itemprops:

        -   citationMode: `data`? (maybe unnecessary for styling)
        -   pageStart: `span`
        -   pageEnd: `span`
        -   pagination: `span`
        -   prefix: `span`
        -   suffix: `span`
        -   target: `a href`
        -   authors: (not listed in schema, but seems necessary) `ol`
        -   title: (not listed in schema, but seems necessary) `span`
-   CiteGroup

    -   `ol` `itemtype='stencila:CiteGroup'`
    -   itemprops:

        -   items: `li ul` for each Cite (see above)
-   Code

    -   `code` `itemtype='stencila:Code'`

        -   value\*: set as `code` textContent
    -   itemprops:

        -   language\* (maybe important for setting syntax highlighting): `data`
-   CodeChunk

    -   `<pre><code>...</code></pre>` `itemtype='stencila:CodeChunk'`
    -   itemprops:

        -   outputs: `pre` containing `samp`/`output` (see <https://html.spec.whatwg.org/multipage/grouping-content.html#the-pre-element>)

            -   In future, consider including `figure`/`table`
-   CodeExpression

    -   `code` `itemtype='stencila:CodeExpr'`

        -   value: set as `code` textContent (syntax highlighting from SoftwareSourceCode node's programmingLanguage prop)
-   Collection

    -   `ol` `itemtype='schema:Collection'`
    -   itemprops:

        -   parts: `li > a href` CreativeWorks/Articles (just title, author, and URIs/relative links?)
-   ContactPoint

    -   `address` `itemtype='schema:contactPoint'`
    -   itemprops:

        -   availableLanguages: `ul` of `data`? if not `p` (maybe unnecessary for styling)
        -   emails: `ol` of `a href`
        -   telephone: `a href`
-   CreativeWork:

    -   `div` `itemtype='schema:CreativeWork'`
    -   itemprops:

        -   authors: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
        -   references: `ol itemprop='stencila:CiteGroup'` of `li ul` Cite itemtypes (see above) with `ol` authors, `a href` target, `span` title
        -   content: `article`/`div` with `sections`
        -   dateCreated: `span time`
        -   dateModified: `span time`
        -   datePublished/date: `span time`
        -   editors: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)
        -   funders: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
        -   isPartOf: `data`?
        -   licenses: `ol` of `a href`
        -   parts/hasPart: `ol` of figure/table/object/URI (maybe unnecessary for styling)
        -   publisher: `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
        -   text: `data`? (maybe unnecessary for styling)
        -   title/headline: `h1`
        -   version: `span`
-   DataTable:

    -   `table` or `figure table` `itemtype='stencila:Datatable'`
    -   columns: probably want to convert these DatatableColumns into rows when encoding into HTML, so they're made up of `tr` and `td`/`th`. Maybe keep as `data`?

        -   values: `td`
        -   schema (items, uniqueItems): `data`? (maybe unnecessary for styling)
        -   name: `th`?
-   Organization:

    -   `div` `itemtype='schema:Organization'`
    -   legalName: set as `div` textContent
    -   Need to determine which itemprops are important to show. Maybe just `address`, `brand`, `departments`, and `legalName`.
    -   itemprops:

        -   address: `address` `itemprop='schema:address'`
        -   brands: `ul` of `picture`/`img` (see `Brand` above)
        -   contactPoints: `ul` of `li address` (see `ContactPoint` above)
        -   departments: `ul` of `span` Organization `legalName`
        -   funders: `data`? (maybe unnecessary for styling, since `funders` included seperately in CreativeWork)
        -   parentOrganization: `data`? (maybe unnecessary for styling)
-   Periodical:

    -   dateStart, dateEnd: `data`? (maybe unnecessary for styling)
    -   issn: `p`
-   Person:

    -   `div` `itemtype='schema:Person'`
    -   Need to determine which itemprops are important to show. Maybe just `affiliations`, `familyNames`, `givenNames`, `name`, `honorificPrefix`, `honorificSuffix`, and `jobTitle`.
    -   itemprops:

        -   address: `address` `itemprop='schema:address'` or `data`? (maybe unnecessary for styling)
        -   affiliations: `ul` of `span` Organization `legalName` + `departments`
        -   emails: `data`? (maybe unnecessary for styling)
        -   familyNames: `ul` of `span`
        -   funders: `data`? (maybe unnecessary for styling)
        -   givenNames: `ul` of `span`
        -   honorificPrefix: `span`
        -   honorificSuffix: `span`
        -   jobTitle: `span`
        -   memberOf: `ul` of `span` Organization `legalName` + `departments`, or `data`? (maybe unnecessary for styling)
        -   telephoneNumbers: `data`? (maybe unnecessary for styling)
-   PublicationIssue:

    -   `ul` `itemtype='stencila:PublicationIssue'`
    -   itemprops:

        -   issueNumber: `span`
        -   pageStart: `span`
        -   pageEnd: `span`
        -   pagination: `span`
        -   authors: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
        -   title/headline: `span`
-   PublicationVolume:

    -   `ul` `itemtype='stencila:PublicationVolume'`
    -   itemprops:

        -   pageStart: `span`
        -   pageEnd: `span`
        -   pagination: `span`
        -   volumeNumber: `span`
        -   authors: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
        -   title/headline: `span`
-   SoftwareSourceCode:

    -   codeRepository: `a href`
    -   codeSampleType: `data`?
    -   maintainers: `ol` of `span` Person `name` (or combined `givenNames`+`familyNames`)/Organization `legalName`.
    -   programmingLanguage: `data` or `span` (maybe unnecessary for styling)
    -   runtimePlatform: `ol` of `data` or `span`
    -   softwareRequirements: `ol` of `span` SoftwareSourceCode/SoftwareApplication
    -   targetProducts: `ol` of `span` SoftwareApplication

### Schema nodes with direct mapping to semantic tags

-   AudioObject: `audio`

    -   name => `figcaption`, or `p`
    -   caption, transcript => `track` (if `video`), or `data`. [Consider using `video` instead of `audio` to enable captions](https://www.iandevlin.com/blog/2015/12/html5/webvtt-and-audio/), or display separately as `div`.
    -   contentUrl => `audio src`
-   Delete: `del`
-   Emphasis: `em`
-   Heading: `h1` ... `h6`
-   ImageObject: `figure`

    -   thumbnail => `img`
    -   caption => `figcaption`
    -   contentUrl => `img src`
-   Link: `a`

    -   content
    -   target => href
-   List: `ol`, `ul`

    -   ListItem => `li` (with `li` > `input type="checkbox"` option)
-   Paragraph => `p`
-   Quote => `q`

    -   citation => `q cite`
-   QuoteBlock => `blockquote`

    -   citation => `blockquote cite`
    -   content => `p` for each array item
-   Strong => `strong`
-   Subscript => `sub`
-   Superscript => `sup`
-   Table => `table`. `table` > `tr`, or `table` > `thead`/`tfoot` > `tr`

    -   TableRow => `tr`.

        -   `kind`: header => `thead` > `tr`
        -   `kind`: footer => `tfoot` > `tr`
    -   TableCell => `th`, `td`

        -   `colspan`, `rowspan`
        -   `kind`: header => `th`
        -   `kind`: data => `td`
-   ThematicBreak: `hr`? (not sure if we should consider other options, such as splitting nodes by ThematicBreaks and grouping them into `section` tags instead)
-   VideoObject: `video`

    -   caption => `track`. Consider conforming to `uri string` and referencing a `.vtt` file.
    -   thumbnail => poster (attribute)
    -   transcript => `track`? Consider making `transcript` a nested `CreativeWork` or `Article`.
    -   contentUrl => `source src`

### Schema nodes we won't be adding microdata to

-   BlockContent
-   CodeBlock?
-   CreativeWorkTypes
-   Entity
-   Environment?
-   Include?

    -   source
    -   mediaType
    -   hash
    -   content
-   InlineContent
-   Mark
-   MediaObject?

    -   bitrate
    -   contentSize
    -   contentUrl (necessary for `audio`, `img`, `video`)
    -   embedUrl
    -   format
-   Mount?
-   Node
-   Product?

    -   brand
    -   logo
    -   productID
-   ResourceParameters?

    -   resourceLimit
    -   resourceRequested
-   SoftwareApplication?

    -   softwareRequirements
    -   softwareVersion
-   SoftwareSession?

    -   volumeMounts
    -   cpuResource
    -   memoryResource
    -   environment
-   Thing

```html
<html>
  <head>
    <!-- The article title is set as the page `title` -->
    <title>An example of encoding an article</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- Some metadata that is encoded in the article, is also repeated as JSON-LD object here -->
    <script type="application/ld+json">
      {
        "@context": "https://stencila.github.io/schema/stencila.jsonld",
        "type": "Article",
        "authors": [
          {
            "type": "Person",
            "givenNames": ["Janet"],
            "familyNames": ["Carberry"],
            "affiliations": {
              "type": "Organization",
              "name": "Brown University"
            },
            "favoriteColour": "red"
          }
        ],
        "references": [
          {
            "type": "Article",
            "id": "some-one-else-1991",
            "title": "Another article",
            "authors": [
              {
                "type": "Person",
                "givenNames": ["Some", "One"],
                "familyNames": ["Else"]
              }
            ],
            "datePublished": "1991-01-01"
          }
        ]
      }
    </script>

    <!-- Encoda uses themes from Stencila's Thema project to stylize the generated documents -->
    <!-- The necessary JavaScript are inserted into the document -->
    <link
      href="https://unpkg.com/@stencila/thema@1.2.0/dist/themes/stencila/styles.css"
      rel="stylesheet"
    />
    <script
      src="https://unpkg.com/@stencila/thema@1.2.0/dist/themes/stencila/index.js"
      type="text/javascript"
    ></script>
  </head>

  <body>
    <article>
      <h1 role="title">An example of encoding an article</h1>
      <h2 id="my-article-title">My Article title</h2>
      <p>
        Citing an article,<cite
          ><a href="#some-one-else-1991">some-one-else-1991</a></cite
        >inside this article.
      </p>
      <section>
        <h2>References</h2>
        <!-- Items are annotated with itemtype and itemprop attributes corresponding to the Schema nodes -->
        <!-- This allows us to both stylize them appropriately using Thema as well as decode them back propeprly. -->
        <ol itemprop="references">
          <li
            id="some-one-else-1991"
            itemscope="true"
            itemtype="https://schema.org/CreativeWork"
            itemprop="citation"
          >
            <span itemprop="title" itemscope="true">Another article</span>
            <ol itemprop="authors" itemscope="true">
              <li
                itemscope="true"
                itemtype="https://schema.org/Person"
                itemprop="author"
              >
                <span itemprop="familyName">Else</span
                ><span itemprop="givenName">SomeOne</span>
              </li>
            </ol>
            <time itemprop="datePublished" datetime="1991-01-01">1991</time>
          </li>
        </ol>
      </section>
    </article>
  </body>
</html>
```

## Decoding

While Encoda supports the ability to decode fragments of arbitrary (but still valid) HTML elements, when decoding a complete HTML documents, meaning those containing a top level `<html>` tag, it is assumed that the content should be decoded to an [`Article`](https://stencila.github.io/schema/Article).

The decoding process:

-   Starts an instance of [`Puppeteer`](https://github.com/GoogleChrome/puppeteer) to headlessly render the content. The Puppeteer instance is used to search for elements to decode.
-   If the top level element is an `<html>` tag, assume we are decoding an `Article`.
-   If the page `<head>` tag contains a `<script type="application/ld+json">` element, we parse the contents as properties of the `Article`.
-   Take the contents of the `<body>` tag and recursively decode them as the `content`s of the `Article`.
-   Some elements encountered in the `<body>` can contain metadata that will be extracted as the parent `Article` metadata. These can include list of `references`, `authors`, and other similar metadata.

### MicroData enriched HTML

Not all schema types have equivalent HTML tags, so instead we take a generic HTML element, and enrich it with MicroData attributes. For more information regarding the MicroData please visit [the W3 website](https://www.w3.org/TR/microdata/).

In the example below, the generic `<span>` element is understood to be a `Person` schema due to the `itemtype` attribute.

```html
<span itemscope="true" itemtype="https://schema.org/Person" itemprop="author">
  <span itemprop="familyName">Else</span
  ><span itemprop="givenName">SomeOne</span>
</span>
```

The above HTML gets decoded to:

```json
{
  "type": "Person",
  "familyNames": ["Else"],
  "givenNames": ["SomeOne"]
}
```

Note that the `itemprop` attribute value is not used in this case since the HTML snippet is a fragment. However in certain contexts it can be used to differentiate between different types of `Person`s such as `authors`, a `funders`, and `editors`

### Stencila Schema vs HTML specification

To provide the ability for cross-format conversion, the codec intentionally only deals with a subset of the HTML specification. This means that all Stencila schema converted to HTML conforms web specification, but not all found HTML can be decoded into valid Stencila schema. Therefore there will occasionally be information loss, and in such cases Encoda will print warning messages.

#### Example

```html import=link1
<a href="http://example.com">
  <img src="http://example.com/logo.png" alt="Alternative text" title="The title"/>
</a>
```

```json export=link1
{
  "type": "Link",
  "target": "http://example.com",
  "content": [
    {
      "type": "ImageObject",
      "contentUrl": "http://example.com/logo.png",
      "text": "Alternative text",
      "title": "The title"
    }
  ]
}
```

##### Invalid HTML rendered correctly, Invalid Stencila Schema

Because most browsers go to great lengths to visually correctly render HTML, it is hard to spot invalid HTML markup by eye in the wild.

```html import=paraWithList
<p>
  This is a paragraph. Inside it is a list.
  <ul>
    <li>Lists are not valid children of Paragraphs.</li>
    <li>However, browsers are extremely forgiving when rendering HTML content</li>
  </ul>
</p>
```

Since this is invalid HTML markup, Encoda does not provide any guarantees about data loss. However, often the headless browser used to render the content for decoding will insert implicit tags to try and fix the markup. This is why the generated Schema JSON below differs in content from the HTML used to generate it.

Notice that the `List` has been placed outside the `Paragraph`, and that an extraneous empty `Paragraph` has been added to the end.

```json export=paraWithList
[
  {
    "type": "Paragraph",
    "content": [
      "This is a paragraph. Inside it is a list."
    ]
  },
  {
    "type": "List",
    "items": [
      {
        "type": "ListItem",
        "content": [
          "Lists are not valid children of Paragraphs."
        ]
      },
      {
        "type": "ListItem",
        "content": [
          "However, browsers are extremely forgiving when rendering HTML content"
        ]
      }
    ],
    "order": "unordered"
  },
  {
    "type": "Paragraph",
    "content": []
  }
]
```

Running the above JSON through the HTML encoding process returns a different HTML markup, as seen below.

```html export=paraWithList
<span itemtype="https://schema.stenci.la/Array">[{type:'Paragraph',content:['This is a paragraph.
  Inside it is a list.']},{type:'List',order:'unordered',items:[{type:'ListItem',content:['Lists are
  not valid children of Paragraphs.']},{type:'ListItem',content:['However, browsers are extremely
  forgiving when rendering HTML content']}]},{type:'Paragraph',content:[]}]</span>
```
